% !TEX program = xelatex -shell-escape
% !TEX spellcheck = cs_CZ

% Nejprve uvedeme tridu dokumentu s volbami
\documentclass[czech,master,dept460,male,cpp,cpdeclaration]{diploma}
% Dalsi doplnujici baliky maker

\usepackage[backend=biber, style=iso-numeric, alldates=iso]{biblatex} % bibliografie

\usepackage{dcolumn} % sloupce tabulky s ciselnymi hodnotami
\usepackage{subfig} % makra pro "podobrazky" a "podtabulky"
\usepackage{xevlna}
\usepackage{tikz}
\usepackage{mathtools}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{esvect}
\usepackage{pgfplots}
\usepackage{fontspec}
\usepackage{minted}
\usepackage[autostyle=true,czech=quotes]{csquotes} % korektni sazba uvozovek, podpora pro balik biblatex
\usepackage{pifont}
\usepackage{xcolor}
\usepackage{hyperref}

%\setmonofont{[JetBrainsMono-Regular.ttf]}[Contextuals=Alternate,Ligatures=TeX]
%\setmonofont{[Computer Modern]}
\pdfminorversion=6

%Značení normovaného vektoru
%\newcommand{\uvec}[1]{\boldsymbol{\hat{#1}}}
\newcommand{\uvec}[1]{\hat{#1}}
\newcommand{\rough}{\sigma}
\newcommand{\alb}{\rho}
\newcommand{\randU}{\xi_{1}}
\newcommand{\randV}{\xi_{2}}

\pgfplotsset{compat=newest}


\newminted{c++}{
    style=vs,
    frame=lines
}


\newcommand{\true}{\ding{51}}
\newcommand{\false}{\ding{55}}
\newcommand{\unknown}{\dots}

% Zadame pozadovane vstupy pro generovani titulnich stran.
\ThesisAuthor{Richard Zvonek}

\CzechThesisTitle{Interaktivní prohlížeč BRDF funkcí}

\EnglishThesisTitle{Interactive Visualization of BRDF Functions}

\SubmissionDate{30.dubna 2021}

% Pokud nechceme nikomu dekovat makro zapoznamkujeme.
\Thanks{Rád bych na tomto místě poděkoval všem, kteří mi s prací pomohli, protože bez nich by tato práce nevznikla.}

% Zadame cestu a jmeno souboru ci nekolika souboru s digitalizovanou podobou zadani prace.
% Pokud toto makro zapoznamkujeme sazi se stranka s upozornenim.
\ThesisAssignmentImagePath{Figures/Assignment}

% Zadame soubor s digitalizovanou podobou prohlaseni autora zaverecne prace.
% Pokud toto makro zapoznamkujeme sazi se cisty text prohlaseni.
\AuthorDeclarationImageFile{Figures/AuthorDeclaration.jpg}


% Zadame soubor s digitalizovanou podobou souhlasu spolupracujici prav. nebo fyz. osoby.
% Pokud toto makro zapoznamkujeme sazi se cisty text souhlasu.
\CooperatingPersonsDeclarationImageFile{Figures/CoopPersonDeclaration.jpg}

\CzechAbstract{TODO Czech abstract}

\CzechKeywords{TODO Klíčová slova}

\EnglishAbstract{TODO Eng abstract}

\EnglishKeywords{TODO keywords}

\AddAcronym{BRDF}{bidirectional reflectance distribution function}

\addbibresource{main.bib}

% Novy druh tabulkoveho sloupce, ve kterem jsou cisla zarovnana podle desetinne carky
\newcolumntype{d}[1]{D{,}{,}{#1}}


% Zacatek dokumentu
\begin{document}

% Nechame vysazet titulni strany.
\MakeTitlePages
% A nasleduje text zaverecne prace.

\section{Úvod}
TODO
\clearpage
\section{Realistický rendering}
\textit{TODO, pojmy:  realistický rendering, path tracing, renderovací rovnice, monte carlo, světlo, osvětlovací model (lokální, globální iluminace), osvětlení pomocí HDR}

\clearpage
\section{BRDF}
BRDF je matematická funkce, která definuje pro daný materiál odrazivost povrchu. Určuje pro každý bod tělesa distribuci odrazu světla. Na \hyperref[fig:brdf2D]{obrázku \ref{fig:brdf2D}} je znázorněn základní princip BRDF funkce. Vektor \(\vv{n}\) je normála povrchu, \(\vv{\omega}_{in}\) značí směr ke světelnému zdroji, \(\vv{\omega}_{out}\) značí směr k pozorovateli (ke kameře). BRDF je definována pro dvojici vektorů  \(\vv{\omega}_{in}\) a \(\vv{\omega}_{out}\) v daném bodě \(p\) pomocí \hyperref[eq:brdf]{vzorce \ref{eq:brdf}}.
% Pbrt strana 350

\begin{equation} \label{eq:brdf}
    f_r\left(p,\omega_{out},\omega_{in}\right) = \frac{dL_o\left(p, \omega_{out}\right)}{dE\left(p, \omega_{in}\right)} = \frac{dL_o\left(p, \omega_{out}\right)}{L_i\left(p, \omega_{in}\right)\cos \theta_{in}d\omega_{in}}
\end{equation}

Je žádoucí, aby BRDF funkce splňovaly některá základní pravidla. Je důležitá  fyzikální přesnost BRDF funkce, pro kterou musí být musí být splněny následující podmínky \cite{PHARR2017313}:
\begin{enumerate}
    % 10.3 Reciprocity 
    \item Princip vzájemnosti (Helmholtzův princip reciprocity, \cite{hapke_2012}) - Pro všechny dvojice \(\vv{\omega}_{in}\) a \(\vv{\omega}_{out}\) platí: \(f_r\left(p,\omega_{out},\omega_{in}\right) = f_r\left(p,\omega_{in},\omega_{out}\right)\)
    \item Princip zachování energie - Celková energie odraženého světla nemůže být vyšší, než energie vstupního světla
    \item BRDF musí mít vždy nezáporný výsledek
\end{enumerate}
\begin{figure}[ht!]
    \centering
    \begin{tikzpicture}[scale=0.6]
        % base circle
        \draw (-4,0) arc (180:360:4 and 1);
        \draw [dashed] (-4,0) arc (180:0:4 and 1);
        % hemisphere
        \draw (-4,0) arc (180:0:4 and 4);

        \draw [thick, ->] (0,0) -- ++(-5,0) node [at end, above] () {\(\vv{t}\)};
        \draw [thick, ->] (0,0) -- ++(135:5cm) node [at end, above] () {\(\vv{\omega}_{out}\)};
        % y
        \draw [thick, thick, ->] (0,0) -- ++(0,5) node [at end, above] () {\(\vv{n}\)};
        % z
        \draw [thick, ->] (0,0,0) -- ++(0,-2.5,-2.5) node [at end, above] () {\(\vv{b}\)};
        % lines spanning angle alpha
        \draw [thick, ->] (0,0) -- ++(45:5cm) node [at end, above] () {\(\vv{\omega}_{in}\)};

        \draw [thin, dashed] (0,0) -- ++(55:3cm);
        \draw [thin, dashed] (0,0) -- ++(35:3cm);

        \draw[thin, dashed, rotate=45] (3,0) ellipse (0.25cm and 0.5cm);

        \draw [thin, <->] (0,0) ++(90:1.5cm) arc (90:45:1.5cm) node [midway, above] () {\(\theta_{in}\)};

        \draw [thin, dashed] (1.5,1.5) -- ++(0,-2);
        \draw [thin, dashed] (0,0) -- ++(1.5,-0.5);

        \draw [thin, dashed] (-2,2) -- ++(0,-2.53);
        \draw [thin, dashed] (0,0) -- ++(-2,-0.5);

        \draw [thin, <->] (0,0) ++(180:2.1cm) arc (185:205:1.5cm) node [midway, left] () {\(\phi_{out}\)};

        \draw [thin, <->] (0,0) ++(180:1.7cm) arc (185:326:1.5cm and 0.75cm) node [midway, left] () {\(\phi_{in}\)};

        \draw [thin, <->] (0,0) ++(90:2cm) arc (90:135:2cm) node [midway, above] () {\(\theta_{out}\)};


        \draw (-0.05,-0.3) node () {\(p\)};
    \end{tikzpicture}
    \caption{Základní vizualizace BRDF funkce}
    \label{fig:brdf2D}
\end{figure}

\subsection{Přehled BRDF funkcí}
Následující odstavce se zabývají detailním popisem a vlastnostmi jednotlivých BRDF funkcí. Budou zde vyjmenovány pouze ty BRDF funkce, které byly implementovány v praktické části této diplomové práce. \\
Pro rychlý přehled vlastností jednotlivých BRDF funkcí je možné využít \hyperref[tab:brdfProperties]{tabulku \ref{tab:brdfProperties}} (převzato z \cite{BRDFOverview}, zkráceno, doplněno).

\begin{table}[ht]
    \centering
    \begin{tabular}{r|lllllll}
        \hline
        BRDF model          & \rotatebox{90}{Physical} & \rotatebox{90}{Plausible} & \rotatebox{90}{Fresnel Eq}. & \rotatebox{90}{Anisotropic} & \rotatebox{90}{Sampling} & \rotatebox{90}{Rel. cost (cycles)} & \rotatebox{90}{Material type} \\
        \hline
        Ideal reflection    & \true                    & \true                     & \false                      & \false                      & \true                    & \(x\)                              & Mirror, perfect spec.         \\
        Lambert             & \true                    & \true                     & \false                      & \false                      & \true                    & \(x\)                              & Perfect diffuse               \\
        Phong               & \false                   & \false                    & \false                      & \false                      & \true                    & \unknown                           & Rough surf.                   \\
        Blinn-Phong         & \false                   & \false                    & \false                      & \false                      & \true                    & \(9.18x\)                          & Rough surf.                   \\
        Phys. correct Phong & \false                   & \true                     & \false                      & \false                      & \true                    & \unknown                           & Rough surf.                   \\
        Torrance-Sparrow    & \true                    & \false                    & \true                       & \true                       & \false                   & \unknown                           & Rough surf.                   \\
        Cook-Torrance       & \true                    & \true                     & \true                       & \false                      & \false                   & \(16.9x\)                          & Metal, plastic                \\
        Oren-Nayar          & \true                    & \true                     & \false                      & \false                      & \true                    & \(10.98x\)                         & Matte, dirty                  \\
        \hline
    \end{tabular}
    \caption{Stručný přehled implementovaných BRDF funkcí}
    \label{tab:brdfProperties}
\end{table}

\subsubsection{Lambert} \label{sec:Lambert}
Lambertovo BRDF (Lambertovský povrch) se řadí mezi analytické modely BRDF. Popisuje ideálně matné povrchy, které odráží příchozí světlo do všech směrů rovnoměrně se stejnou pravděpodobností, nehledě na příchozí směr paprsku. Jedná se o nejjednodušší BRDF funkci, je definována \hyperref[eq:lambertBRDF]{vztahem \ref{eq:lambertBRDF}} \cite{Koppal2014}.
%COmputer vision reference guide katushi, page 675 - Lambertian Reflectance
\begin{equation} \label{eq:lambertBRDF}
    f_r\left(p,\omega_{out},\omega_{in}\right) = \frac{\alb}{\pi} = konst.
\end{equation}
\(\alb\) ve \hyperref[eq:lambertBRDF]{vztahu \ref{eq:lambertBRDF}} vyjadřuje poměr mezi pohlceným a odraženým světlem. Tato veličina je také odborně nazývána pojmem albedo. Dělení konstantou \(\pi\) zajišťuje platnost zákona zachování energie. Díky nezávislosti na směru vstupního paprsku je také splněna reciprocita.

\subsubsection{Phong} \label{sec:Phong}
Phongovo BRDF vychází z Phongova osvětlovacího modelu, řadí se mezi analytické modely BRDF a používá se pro lesklé povrchy. Původní model je definován \hyperref[eq:phongBRDF]{vzorcem \ref{eq:phongBRDF}} \cite{Phong1975}
\begin{equation} \label{eq:phongBRDF}
    f_r\left(p,\omega_{out},\omega_{in}\right) = k_s(\uvec{r}\cdot\omega_{out})^n
\end{equation}

Upravený, také často využívaný Blinn-Phong model je definován \hyperref[eq:blinnBRDF]{vzorcem \ref{eq:blinnBRDF}} \cite{BlinnPhong1977}. Výhodou upraveného Blinn-Phongova modelu oproti klasickému Phongovu modelu je hladší přechod odlesku světla.

\begin{equation} \label{eq:blinnBRDF}
    f_r\left(p,\omega_{out},\omega_{in}\right) = k_s(\uvec{n}\cdot\uvec{h})^n
\end{equation}

Jak Phong, tak Blinn-Phong modely nejsou fyzikálně přesné - nesplňují zákon zachování energie, ani zákon reciprocity \cite{BRDFOverview}. Phongovo BRDF je možné dále upravit, aby byly splněny pravidla pro fyzikální korektnost. Fyzikálně korektní Phongovo BRDF je definováno \hyperref[eq:phongPhysicalBRDF]{vzorcem \ref{eq:phongPhysicalBRDF}}. Pro fyzikální korektnost této varianty Phongova BRDF je potřeba dodržet \(k_d + k_s \leq 1\) \cite{LaFortunePhongBRDF}.

\begin{equation} \label{eq:phongPhysicalBRDF}
    f_r\left(p,\omega_{out},\omega_{in}\right) = \frac{k_d}{\pi} +
    \frac{k_s\left(n+2\right)}{2\pi}\left(\cos\theta_r\right)^n
\end{equation}

Pro výpočet Phongova BRDF jsou využity následující parametry:
\begin{itemize}
    \item[\(k_s\):] Koeficient odrazivosti materiálu
    \item[\(k_d\):] Difuzivní koeficient materiálu
    \item[\(n\):] Lesklost materiálu
    \item[\(\uvec{r}\):] Vektor zrcadlového odrazu světla, platí: \(\uvec{r} = 2\left(\omega_{in}\cdot\uvec{n}\right)\uvec{n}-\omega_{in}\)
    \item[\(\uvec{h}\):] Poloviční vektor mezi pohledovým a světelným vektorem. Platí: \(\uvec{h} = \frac{\omega_{in} + \omega_{out}}{\| \omega_{in} + \omega_{out}\|}\)
    \item[\(\theta_r\):] Úhel odrazu, platí: \(\cos\theta_r = \omega_{out}\cdot\uvec{r}\)
\end{itemize}

\subsubsection{Torrance-Sparrow} \label{sec:torrancesparrow}
Torrance-Sparrow BRDF patří mezi fyzikální modely a je považován za jeden s nejúplnějších modelů \cite{BRDFOverview}. Mimo jiné je např. schopen simulovat odlesk polarizovaného světla. Tento model simuluje mikroploškové materiály a pomocí parametru roughness (drsnost) simuluje mikroskopické nerovnosti materiálu. Orientace mikroskopických nerovností je v materiálu náhodná. Vyšší hodnota drsnosti materiálu snižuje lesklost materiálu. Torrance-Sparrow brdf funkce je definována \hyperref[eq:TorranceSparrow]{vzorcem \ref{eq:TorranceSparrow}}. \par
Pro výpočet se používá distribuční funkce \(D\), která generuje rozložení normál mikroplošek. V této konkrétní implementaci je použita Beckmannova distribuční funkce (viz \hyperref[eq:beckDistr]{vzorec \ref{eq:beckDistr}}). Beckmannova distribuční funkce pracuje s normálou mikroplošky (kolem které se generuje rozložení) a hodnotou drsnosti materiálu. Jako normála mikroplošky je použit poloviční vektor mezi pohledovým a světelným vektorem (viz \hyperref[sec:Phong]{\ref{sec:Phong} Phong}) z důvodu, že mikroploška perfektně odráží světlo právě v případě, kdy je orientovaná podél polovičního vektoru \cite{PHARR2017507}. \par
Dále se počítá poměr odraženého světla a lomeného světla \(F\) pomocí Fresnelových vzorců. Pro výpočet je použita Schlickova aproximace (viz \hyperref[eq:schlickFresnel]{vzorec \ref{eq:schlickFresnel}}) \cite{SchlickFresnel}. \par
Poslední část pro výpočet je koeficient geometrického útlumu \(G\), která vyjadřuje zakrytí mikroplošek při odrazu světla (viz \hyperref[eq:geomAtatenuation]{vzorec \ref{eq:geomAtatenuation}}) \cite{BRDFOverview}.


\begin{eqnarray}
    f_r\left(p,\omega_{out},\omega_{in}\right) & = & \frac{k_d}{\pi} + \frac{k_sD(h,m)F(\omega_{out})G(\omega_{out},\omega_{in})}{4\pi (\uvec{n}\cdot \omega_{in})}\label{eq:TorranceSparrow}\\
    D(h,m) & = & \frac{e^{\left(\frac{(\uvec{n}\cdot \uvec{h})^2-1}{m^2(\uvec{n}\cdot \uvec{h})^2}\right)}}{m^2(\uvec{n}\cdot \uvec{h})^2}\label{eq:beckDistr}\\
    F(\omega_{out}) & \approx & R(\theta) = f_0 + (1-f_0)(1-\cos\theta)^5\label{eq:schlickFresnel}\\
    G(\omega_{out},\omega_{in}) & = & min \left( 1, \frac{2 ( \uvec{n} \cdot \uvec{h} ) ( \uvec{n} \cdot \omega_{out} )
        }{ ( \omega_{out} \cdot \uvec{h} ) },\frac{ 2 ( \uvec{n} \cdot \uvec{h} ) ( \uvec{n} \cdot \omega_{in} ) }{ ( \omega_{out} \cdot \uvec{h} ) } \right) \label{eq:geomAtatenuation}
\end{eqnarray}
\subsubsection{Cook-Torrance}
Cook-Torrance BRDF rozšiřuje mikroploškové BRDF s myšlenkou, že pouze mikroplošky orientované podél vektoru \(\uvec{h}\) mají vliv na výsledném odrazu světla. Odrazová složka výsledného obrazu využívá pro výpočet opět funkce \(F, D, G\) (viz \hyperref[sec:torrancesparrow]{\ref{sec:torrancesparrow} Torrance-Sparrow}). Cook-Torrance BRDF se vypočítá podle \hyperref[eq:CookTorrance]{vzorce \ref{eq:CookTorrance}} \cite{CookTorranceBRDF}. Nevýhodou této BRDF funkce je nesplnění fyzikální přesnosti z důvodu nesplnění zákona zachování energie pro některé úhly \(\omega_{out},\omega_{in}\) \cite{BRDFOverview}.

\begin{equation} \label{eq:CookTorrance}
    f_r\left(p,\omega_{out},\omega_{in}\right)  = \frac{F(\omega_{out})}{\pi} \frac{D(h,m)}{(\uvec{n}\cdot\omega_{in})} \frac{G(\omega_{out},\omega_{in})}{(\uvec{n}\cdot\omega_{out})}
\end{equation}

\subsubsection{Oren-Nayar}
Oren-Nayar BRDF popisuje Lambertovské difusivní materiály. Oproti Lambertovu BRDF (\hyperref[sec:Lambert]{viz \ref{sec:Lambert} Lambert}) pracuje s mikroploškami, které ale na rozdíl od mikroplošek popisovaných např. \hyperref[sec:torrancesparrow]{Torrance-Sparrow} modelem nejsou odrazivé, ale difuzivní. Oren-Nayar bere v úvahu odrazy světla mezi jednotlivými mikroploškami s limitovaným maximálním počtem odrazů mezi dvojicí mikroplošek. Pro generování distribuce orientace mikroplošek je použito Gaussovo rozdělení \cite{OrenNayar} \cite{BRDFOverview}. Oren-Nayar BRDF je definováno \hyperref[eq:OrenNayar]{vzorcem \ref{eq:OrenNayar}}

\newcommand{\cosphiri}{\cos\left(\phi_r-\phi_i\right)}

\begin{eqnarray}
    \alpha & = & max(\theta_{in}, \theta_{out}) = max(\arccos(\uvec{n}\cdot\omega_{in}), \arccos(\uvec{n}\cdot\omega_{out})) \nonumber \\
    \beta & = & min(\theta_{in}, \theta_{out}) = min(\arccos(\uvec{n}\cdot\omega_{in}), \arccos(\uvec{n}\cdot\omega_{out})) \nonumber \\
    \cosphiri & = & \widehat{\left( \omega_{in} - \uvec{n}(\uvec{n}\cdot\omega_{in}) \right)} \cdot \widehat{\left( \omega_{out} - \uvec{n}(\uvec{n}\cdot\omega_{out})  \right)} \nonumber \\
    C_1 & = & 1-0.5\frac{\rough^2}{\rough^2 + 0.33} \nonumber \\
    C_2 & = & \left\{\begin{matrix*}[l] 0.45\frac{\rough^2}{\rough^2+0.09}\sin\alpha & \cosphiri \geq 0\\ 0.45\frac{\rough^2}{\rough^2+0.09}\left(\sin\alpha-\left(\frac{2\beta}{\pi}\right)^3\right) & jinak \end{matrix*}\right. \nonumber \\
    C_3 & = & 0.125\left(\frac{\rough^2}{\rough^2 + 0.009}\right)\left(\frac{4\alpha\beta}{\pi^2}\right)^2 \nonumber \\
    L^{1}_{r} & = & \frac{\alb}{\pi}\left[C_1 + \cosphiri C_2\tan\beta + \left( 1-\left | \cosphiri  \right | \right)C_3\tan \left(\frac{\alpha+\beta}{2}\right)\right] \nonumber \\
    L^{2}_{r} & = & 0.17\frac{\alb^2}{\pi}\frac{\rough^2}{\rough^2+0.13}\left[1 - \cosphiri  \left(\frac{2\beta}{\pi}\right)^2 \right] \nonumber \\
    f_r\left(p,\omega_{out},\omega_{in}\right) & = & L^{1}_{r} + L^{2}_{r} \label{eq:OrenNayar}
\end{eqnarray}

\clearpage
\section{Vizualizace BRDF}
Následující odstavce se zabývají konkrétními detaily implementace a technických řešení pro zobrazení BRDF funkcí.

\subsection{Generování vizualizace BRDF}
Při implementaci jsem se chtěl co nejvíce přiblížit standardním referenčním obrázkům popisujícím princip BRDF funkcí (viz \hyperref[fig:brdf2D]{obrázek \ref{fig:brdf2D}}). Pro vizualizaci jsem se rozhodl vygenerovat jednotkovou polokouli a jednotlivé body polokoule upravit v OpenGL Vertex shaderu. Při generování polokoule jsem narazil na problém, kdy pro vizualizaci bylo potřeba mít co nejrovnoměrněji rozložené polygony, ideálně všechny s podobnou velikostí. Rozhodl jsem se tedy negenerovat UV kouli, ale geodetický mnohostěn (srovnání na \hyperref[fig:spheresComparison]{obrázku \ref{fig:spheresComparison}}), který je tvořen rovnostrannými trojúhelníky. Pro zjednodušení jsem vycházel z kódu pro dvacetistěn \cite{OpenGLSphere}, jehož trojúhelníkové stěny jsem dále rekurzivně dělil. Postup generování hemisféry použité pro vykreslení BRDF funkcí je zobrazen na \hyperref[fig:hemisfera]{obrázku \ref{fig:hemisfera}}.

\begin{figure}[ht]
    \centering
    \includegraphics[width=10cm]{Figures/IcosphereUVSphereComparison.png}
    \caption{Srovnání UV koule a geodetického mnohostěnu, z \cite{tan_2019}}
    \label{fig:spheresComparison}
\end{figure}
\begin{figure}[ht]%
    \centering
    \subfloat[Dvacetistěn \label{fig:icasehedron}]{{\includegraphics[width=5cm]{Figures/icosphere.png} }}%
    \qquad
    \subfloat[Poloviční dvacetistěn \label{fig:halficasehedron}]{{\includegraphics[width=5cm]{Figures/halficosphere.png} }}%
    \qquad
    \subfloat[Poloviční dvacetistěn, \(1\times\) rozdělené polygony \label{fig:halficasehedron1}]{{\includegraphics[width=5cm]{Figures/halficosphere1.png} }}%
    \qquad
    \subfloat[Poloviční dvacetistěn, \(3\times\) rozdělené polygony \label{fig:halficasehedron3}]{{\includegraphics[width=5cm]{Figures/halficosphere3.png} }}%
    \caption{Postup generování hemisféry}%
    \label{fig:hemisfera}%
\end{figure}


\clearpage
\section{Redukce variance, optimalizace Monte carlo}
Následující kapitoly se zabývají redukcí variance při výpočtu renderovací rovnice pomocí Monte Carlo metody.
\subsection{Vzorkování směrů odražených paprsků}
\subsection{Převod sférických souřadnic}
Při výpočtu vzorkování se často počítá se sférickými souřadnicemi. Pro převod vektoru definovaného sférickými souřadnicemi do kartézských souřadnic je možné použít \hyperref[eq:sphericalToCartesian]{vzorec \ref{eq:sphericalToCartesian}}
\begin{eqnarray}
    x & = & \sin(\theta)\cos(\phi)\nonumber \\
    y & = & \sin(\theta)\sin(\phi)\nonumber \\
    z & = & \cos(\theta)\label{eq:sphericalToCartesian}
\end{eqnarray}

\subsection{Vzorkování hemisféry}
Jednou z nejjednodušších metod pro vzorkování je vzorkování hemisféry. Uniformní vzorkování hemisféry je definováno \hyperref[eq:hemisphereSampling]{vzorcem \ref{eq:hemisphereSampling}} (ve sférických souřadnicích). Rozdělení pravděpodobnosti je konstantní, definováno \hyperref[eq:hemisphereSamplingPdf]{vzorcem \ref{eq:hemisphereSamplingPdf}}. Při tomto vzorkování jsou všechny paprsky rovnoměrně rozdělené, všechny směry mají stejnou pravděpodobnost odrazu. Takové vzorkování je možné použít pro všechny BRDF funkce. Nevýhodou tohoto vzorkování je ale neoptimálnost vůči různým BRDF funkcím. Ideálně by vzorkovací funkce měla co nejpřesněji kopírovat BRDF funkci. \par

\begin{eqnarray}
    \theta & = & \arccos(\randU) \nonumber \\
    \phi & = & 2\pi\randV \label{eq:hemisphereSampling}
\end{eqnarray}

\begin{equation} \label{eq:hemisphereSamplingPdf}
    p = \frac{1}{2\pi}
\end{equation}

Jedna z možností optimalizace je použití vzorkování hemisféry zatížené cosinem úhlu mezi vstupním paprskem a normálou povrchu.. Základní tezí je, že paprsky s největším úhlem mají nejmenší vliv na výsledné osvětlení v daném bodě. Vzorkování by tedy mělo mít rozložení vzorků více kumulované ve směru normály oproti ostatním směrům. Jednou z možností jak generovat paprsky touto metodou je pomocí Malleyho metody. Tato metoda spočívá v generování bodu v jednotkovém disku pomocí soustředných kruhů \cite{PHARR2017747}. Výsledné souřadnice v kartézském systému se vypočítají pomocí \hyperref[eq:concentricHemisphere]{vzorce \ref{eq:concentricHemisphere}}. Pro výpočet je potřeba převést $\randU$ a $\randV$ z intervalu $<0;1>$ do intervalu $<-1;1>$  Rozdělení pravděpodobnosti je definováno \hyperref[eq:concentricHemisphere]{vzorcem \ref{eq:concentricHemispherePdf}}.

\begin{eqnarray}
    r & = & \left\{\begin{matrix*}[l] \randU & |\randU| > \left | \randV \right |\\ \randV & jinak \end{matrix*}\right. \nonumber \\
    \Theta & = & \left\{\begin{matrix*}[l] \frac{\pi}{4}\frac{\randV}{\randU} & |\randU| > \left | \randV \right |\\ \frac{\pi}{2}-\frac{\pi}{4}\frac{\randU}{\randV} & jinak \end{matrix*}\right. \nonumber \\
    x & = &r\cos(\Theta)\nonumber \\
    y & = &r\sin(\Theta)\nonumber \\
    z & = &\sqrt{ \max(0, 1 - x^2 + y^2) }\label{eq:concentricHemisphere}
\end{eqnarray}

\begin{equation} \label{eq:concentricHemispherePdf}
    p = \frac{\cos\theta}{\pi}
\end{equation}

\printbibliography[title={Literatura}, heading=bibintoc]
\appendix
\end{document}